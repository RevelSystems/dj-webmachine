

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Simple Routing &mdash; dj-webmachine v0.2.1 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="dj-webmachine v0.2.1 documentation" href="index.html" />
    <link rel="up" title="Documentation" href="docs.html" />
    <link rel="next" title="Handle authorization" href="auth.html" />
    <link rel="prev" title="dj-webmachine Resource object methods" href="resources.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="auth.html" title="Handle authorization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="resources.html" title="dj-webmachine Resource object methods"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">dj-webmachine v0.2.1 documentation</a> &raquo;</li>
          <li><a href="docs.html" accesskey="U">Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="simple-routing">
<span id="wm"></span><h1>Simple Routing<a class="headerlink" href="#simple-routing" title="Permalink to this headline">¶</a></h1>
<p>Combinating the power of Django and the <a class="reference internal" href="resources.html#resources"><em>resources</em></a> it&#8217;s relatively easy to buid an api. The process is also eased using the WM object. dj-webmachine offer a way to create automatically resources by using the <tt class="docutils literal"><span class="pre">route</span></tt> decorator.</p>
<p>Using this decorator, our helloworld example can be rewritten like that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webmachine.ap</span> <span class="kn">import</span> <span class="n">wm</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="nd">@wm.route</span><span class="p">(</span><span class="s">r&quot;^$&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;&lt;html&gt;&lt;p&gt;hello world!&lt;/p&gt;&lt;/html&gt;&quot;</span>


<span class="nd">@wm.route</span><span class="p">(</span><span class="s">r&quot;^$&quot;</span><span class="p">,</span> <span class="n">provided</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;application/json&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">hello_json</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;hellow world&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>and the urls.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">webmachine</span>

<span class="n">webmachine</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s">r&#39;^&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">webmachine</span><span class="o">.</span><span class="n">wm</span><span class="o">.</span><span class="n">urls</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The autodiscover will detect all resources modules and add then to the
url dispatching. The route decorator works a little like the one in
<a class="reference external" href="http://bottle.paws.de/">bottle</a> or for that matter <a class="reference external" href="http://flask.pocoo.org">flask</a> (though bottle was the first).</p>
<p>This decorator works differently though. It creates full
<tt class="xref py py-class docutils literal"><span class="pre">webmachine.resource.Resource</span></tt> instancse registered in the wm
object. So we are abble to provide all the features available in a
resource:</p>
<blockquote>
<ul class="simple">
<li>settings which content is accepted, provided</li>
<li>assiciate serializers to the content types</li>
<li>throttling</li>
<li>authorization</li>
</ul>
</blockquote>
<p>The helloworld could be written in one function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">resource_exists</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="nd">@wm.route</span><span class="p">(</span><span class="s">r&quot;^hello$&quot;</span><span class="p">,</span>
        <span class="n">provided</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;text/html&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">)],</span>
        <span class="n">resource_exists</span><span class="o">=</span><span class="n">resource_exists</span>

        <span class="p">)</span>
<span class="k">def</span> <span class="nf">all_in_one</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">content_type</span> <span class="o">==</span> <span class="s">&quot;application/json&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;hellow world! All in one&quot;</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;&lt;html&gt;&lt;p&gt;hello world! All in one&lt;/p&gt;&lt;/html&gt;&quot;</span>
</pre></div>
</div>
<p>You can see that we set in the decorator the provided contents, we call
a function <tt class="docutils literal"><span class="pre">resources_exists</span></tt> to check if this resource exists. Then
in the function we return the content dependiong on the response content
type depending on the HTTP requests. The response is then automatically
serialized using the <tt class="docutils literal"><span class="pre">json.dumps</span></tt> function associated to the json
content-type. Easy isn&#8217;t it ? You can pass any <a class="reference internal" href="resources.html#resources"><em>resource methods</em></a>
to the decorator.</p>
<div class="section" id="mapping-a-resource">
<h2>Mapping a resource<a class="headerlink" href="#mapping-a-resource" title="Permalink to this headline">¶</a></h2>
<p>You can also map your <a class="reference internal" href="resources.html#resources"><em>Resources classes</em></a> using the wm
object and the method <a class="reference internal" href="#webmachine.api.WM.add_resource" title="webmachine.api.WM.add_resource"><tt class="xref py py-func docutils literal"><span class="pre">webmachine.api.WM.add_resource()</span></tt></a></p>
<p>If a pattern is given, the path will be
<tt class="docutils literal"><span class="pre">/&lt;wmpath&gt;/&lt;app_label&gt;/pattern/resource</span> <span class="pre">urls</span></tt>. if no pattern is given the resource_name will be used.</p>
<p>Ex for urls.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">webmachine</span>
<span class="n">webmachine</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s">r&#39;^wm/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">webmachine</span><span class="o">.</span><span class="n">wm</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>

<span class="p">)</span>
</pre></div>
</div>
<p>and a resources.py file in one django app named hello</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">webmachine</span> <span class="kn">import</span> <span class="n">Resource</span>
<span class="kn">from</span> <span class="nn">webmachine</span> <span class="kn">import</span> <span class="n">wm</span>

<span class="k">class</span> <span class="nc">Hello</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;html&gt;&lt;body&gt;Hello world!&lt;/body&gt;&lt;/html&gt;</span><span class="se">\n</span><span class="s">&quot;</span>


<span class="c"># available at wm/hello</span>
<span class="n">wm</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">Hello</span><span class="p">,</span> <span class="s">r&quot;^hello&quot;</span><span class="p">)</span>

<span class="c"># available at wm/helloworld/hello</span>
<span class="n">wm</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">Hello</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then access to /wm/hello and /wm/hello/hello pathes
automatically.</p>
<p>You can also override the resource path by using the Meta class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Hello</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>If you set the resource path, the resource url added to the
<strong>WM</strong> instance i
<tt class="docutils literal"><span class="pre">/&lt;wmpath&gt;/&lt;app_label&gt;/&lt;resource_path&gt;/resource_urls</span></tt> .</p>
</div>
<div class="section" id="custom-wm-instance">
<h2>Custom WM instance<a class="headerlink" href="#custom-wm-instance" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you want to create custom WM instance instead to use the
global one provided. For that you can import the class
<a class="reference internal" href="#webmachine.api.WM" title="webmachine.api.WM"><tt class="xref py py-class docutils literal"><span class="pre">webmachine.api.WM</span></tt></a>:</p>
<dl class="class">
<dt id="webmachine.api.WM">
<em class="property">class </em><tt class="descclassname">webmachine.api.</tt><tt class="descname">WM</tt><big>(</big><em>name='webmachine'</em>, <em>version=None</em><big>)</big><a class="reference internal" href="modules/webmachine/api.html#WM"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#webmachine.api.WM" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="webmachine.api.WM.add_resource">
<tt class="descname">add_resource</tt><big>(</big><em>klass</em>, <em>pattern=None</em><big>)</big><a class="reference internal" href="modules/webmachine/api.html#WM.add_resource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#webmachine.api.WM.add_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>add one <em class="xref std std-ref">Resource class</em> to the routing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Attr klass:</th><td class="field-body">class inheriting from :class:webmachine.Resource</td>
</tr>
<tr class="field"><th class="field-name">Attr pattern:</th><td class="field-body">regexp.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="webmachine.api.WM.add_resources">
<tt class="descname">add_resources</tt><big>(</big><em>*klasses</em><big>)</big><a class="reference internal" href="modules/webmachine/api.html#WM.add_resources"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#webmachine.api.WM.add_resources" title="Permalink to this definition">¶</a></dt>
<dd><p>allows you to add multiple Resource classes to the WM instance. You
can also pass a pattern by using a tupple instead of simply
provided the Resource class. Ex:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">MyResource</span><span class="p">,</span> <span class="s">r&quot;^some/path$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="webmachine.api.WM.add_route">
<tt class="descname">add_route</tt><big>(</big><em>pattern</em>, <em>func</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="modules/webmachine/api.html#WM.add_route"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#webmachine.api.WM.add_route" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="webmachine.api.WM.get_urls">
<tt class="descname">get_urls</tt><big>(</big><big>)</big><a class="reference internal" href="modules/webmachine/api.html#WM.get_urls"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#webmachine.api.WM.get_urls" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="webmachine.api.WM.route">
<tt class="descname">route</tt><big>(</big><em>pattern</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="modules/webmachine/api.html#WM.route"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#webmachine.api.WM.route" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator that is used to register a new resource using
this function to return response.</p>
<p><strong>Parameters</strong></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Attr pattern:</th><td class="field-body">regular expression, like the one you give in</td>
</tr>
</tbody>
</table>
<p>your urls.py</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Attr methods:</th><td class="field-body">methods accepted on this function</td>
</tr>
<tr class="field"><th class="field-name">Attr provides:</th><td class="field-body">list of provided contents tpes and associated</td>
</tr>
</tbody>
</table>
<p>serializers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[(</span><span class="n">MediaType</span><span class="p">,</span> <span class="n">Handler</span><span class="p">)]</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Attr accepted:</th><td class="field-body">list of content you accept in POST/PUT with</td>
</tr>
</tbody>
</table>
<p>associated deserializers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[(</span><span class="n">MediaType</span><span class="p">,</span> <span class="n">Handler</span><span class="p">)]</span>
</pre></div>
</div>
<p>A serializer can be a simple callable taking a value or a class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Myserializer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">unserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c"># ... do something to value</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c"># ... do something to value</span>
        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Attr formats:</th><td class="field-body">return a list of format with their associated</td>
</tr>
</tbody>
</table>
<p>contenttype:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[(</span><span class="n">Suffix</span><span class="p">,</span> <span class="n">MediaType</span><span class="p">)]</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Attr kwargs:</th><td class="field-body">any named parameter coresponding to a</td>
</tr>
</tbody>
</table>
<p><em class="xref std std-ref">resource method</em>. Each value is a callable
taking a request and a response as arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="webmachine.api.WM.urls">
<tt class="descname">urls</tt><a class="headerlink" href="#webmachine.api.WM.urls" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Simple Routing</a><ul>
<li><a class="reference internal" href="#mapping-a-resource">Mapping a resource</a></li>
<li><a class="reference internal" href="#custom-wm-instance">Custom WM instance</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="resources.html"
                        title="previous chapter">dj-webmachine Resource object methods</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="auth.html"
                        title="next chapter">Handle authorization</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/wm.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="auth.html" title="Handle authorization"
             >next</a> |</li>
        <li class="right" >
          <a href="resources.html" title="dj-webmachine Resource object methods"
             >previous</a> |</li>
        <li><a href="index.html">dj-webmachine v0.2.1 documentation</a> &raquo;</li>
          <li><a href="docs.html" >Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Benoît Chesnea &lt;benoitc@e-engura.org&gt;u.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>